<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Free Spin</title>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: #000;
        font-family: Arial, sans-serif;
      }

      .stage {
        position: fixed;
        inset: 0;
        background: #000;
        z-index: 1;
      }

      .stage video {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .spin-btn {
        position: fixed;
        left: 50%;
        bottom: 2.5rem;
        transform: translateX(-50%);
        padding: 1.25rem 5.5rem;
        font-size: 1.75rem;
        font-weight: 800;
        background: #ffcb05;
        color: #000;
        border: none;
        border-radius: 3.75rem;
        box-shadow: 0 0 0.875rem rgba(0, 123, 255, 0.8);
        cursor: pointer;
        z-index: 10;
        white-space: nowrap;
        transition: transform 0.2s ease;
      }

      .spin-btn:hover {
        transform: translateX(-50%) scale(1.05);
      }
    </style>
  </head>

  <body>
    <div class="stage">
      <video id="video" playsinline preload="auto"></video>
    </div>

    <button id="spinBtn" class="spin-btn">Free spin</button>

    <script>
      const video = document.getElementById("video");
      const btn = document.getElementById("spinBtn");

      const FINAL_URL = "https://bit.ly/3ZhPd8D";

      // 0 = spreman (1.mp4)
      // 1 = 1.mp4 odgledan i zamrznut na zadnjoj sekundi
      // 2 = 2.mp4 odgledan i zamrznut na zadnjem kadru
      let step = 0;
      let playing = false;

      // Učitaj prvi video kao osnovu (bez autoplay)
      video.src = "1.mp4";
      video.muted = false;

      function freezeLastSecondOfCurrentVideo() {
        const t = Math.max((video.duration || 0) - 1, 0);

        // Ako je duration još 0/NaN, probaj čim metadata bude spremna
        if (!isFinite(video.duration) || video.duration === 0) {
          const onMeta = () => {
            video.removeEventListener("loadedmetadata", onMeta);
            freezeLastSecondOfCurrentVideo();
          };
          video.addEventListener("loadedmetadata", onMeta);
          return;
        }

        // Seek na zadnju sekundu i pauziraj čim dođe tamo (nema praznine)
        const onSeeked = () => {
          video.removeEventListener("seeked", onSeeked);
          video.pause();
          playing = false;
        };

        video.addEventListener("seeked", onSeeked);
        video.currentTime = t;
      }

      btn.addEventListener("click", () => {
        if (playing) return;

        // Klik 1: pusti 1.mp4 od početka, pa zamrzni na zadnjoj sekundi
        if (step === 0) {
          playing = true;
          video.muted = false;
          video.src = "1.mp4";
          video.currentTime = 0;

          video.play();

          video.onended = () => {
            // odmah prebaci na zadnju sekundu kao preview (bez crnog ekrana)
            freezeLastSecondOfCurrentVideo();
            step = 1;
          };
        }

        // Klik 2: pusti 2.mp4, pa zamrzni na zadnjem kadru
        else if (step === 1) {
          playing = true;
          video.muted = false;
          video.src = "2.mp4";
          video.currentTime = 0;

          video.play();

          video.onended = () => {
            // freeze zadnji kadar (ostavi currentTime na kraju)
            video.pause();
            playing = false;
            step = 2;
            btn.textContent = "Continue";
          };
        }

        // Klik 3: redirect
        else if (step === 2) {
          window.location.href = FINAL_URL;
        }
      });
    </script>
  </body>
</html>
